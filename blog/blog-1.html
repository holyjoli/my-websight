<h4>Comments</h4>
<div id="comments">
</div>
<form id="commentForm">
  <label for="name">Name:</label><br>
  <input type="text" id="name" name="name"><br>
  <label for="text">Comment:</label><br>
  <input type="textarea" id="text" name="text">
  <button id="send">Send Comment</button>
</form>

<script>
  const userAction = async () => {
  var slug = window.location.href.split("/");
  var url = "https://joliroll.herokuapp.com/comments/" + slug[slug.length - 1];
  const response = await fetch(url);
  const comments = await response.json(); //extract JSON from the http response
  for (var i = 0; i < comments.length; i++) {
    var comment = "<div style='position:relative'><div style='display:inline'>";
    comment += "<h4 style='display:inline'>" + comments[i].name + "    </h4>" + 
               new Date(parseInt(comments[i].date)).toLocaleDateString(); + "</div>";
    comment += "<br>" + comments[i].text;

    comment += "</div>";
    document.getElementById('comments').innerHTML += comment;
  }
}
  userAction();
  
  const commentForm = document.getElementById('commentForm');
  commentForm.addEventListener('submit', async function (e) {
      var url = window.location.href.split("/");
      e.preventDefault();
      var body = {name: document.getElementById("name").value,
                 text: document.getElementById("text").value,
                 slug: url[url.length - 1]
                }
      
      var varis = {
          method: 'POST',
          headers: { 'Content-Type': 'application/json'},
          body: JSON.stringify(body)
      };
    
      let response = await fetch("https://joliroll.herokuapp.com/comments", varis);

      let result = await response.json();
      alert(result.message)
      console.log(result)
  });

</script>
